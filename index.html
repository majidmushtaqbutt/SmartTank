<!doctype html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MLU - Water Tank Meter</title>
    <link rel="stylesheet" href="CSS/fonts/fonts.css">
    <script src="JS/gauge.min.js"></script>
    <style>
        body {
            display: flex;
            align-items: center;
           
            flex-direction: column;
            background: #222;
            height: 100vh;
        }

        .status {
            width: 100%;
            height: 50px;
            text-align: right;
            padding-right: 20px;
            padding-bottom: 50px;
            display: flex;
            align-items: center;
            justify-content: right;

        }

        .status p {
            padding: 10px;
            color: #fff;
            border-radius: 4px;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="status">
        <p id="status"></p>
    </div>
    <canvas data-type="radial-gauge" data-width="400" data-height="400" data-units="Level" data-title="Smart Tank"
        data-value="0" data-animate-on-init="true" data-animated-value="true" data-min-value="0" data-max-value="100"
        data-major-ticks="0,10,20,30,40,50,60,70,80,90,100" data-minor-ticks="2" data-stroke-ticks="false"
        data-highlights='[
            { "from": 0, "to": 10, "color": "rgba(255,30,0,.50)" },
            { "from": 10, "to": 30, "color": "rgba(255,175,7,.9)" },
            { "from": 30, "to": 100, "color": "rgba(40,200,0,.9)" }
        ]' data-color-plate="transparent" data-color-major-ticks="#f5f5f5" data-color-minor-ticks="#ddd"
        data-color-title="#fff" data-color-units="#ccc" data-color-numbers="#eee"
        data-color-needle-start="rgba(240, 128, 128, 1)" data-color-needle-end="rgba(255, 160, 122, .9)"
        data-value-box="true" data-animation-rule="bounce" data-animation-duration="500" data-border-outer-width="3"
        data-border-middle-width="3" data-border-inner-width="3"></canvas>

    <script>
        const socket = new WebSocket('wss://192.168.1.254/ws');
        console.log(window.location.hostname);
        socket.onopen = function (event) {
            console.log("Web Socket Connected...")
            document.getElementById("status").innerHTML = "Connected";
            document.getElementById("status").style.background="#3eb730";
            
        };

        socket.onmessage = function (e) {
            try {
                const data = JSON.parse(e.data);
                console.log(data);
                document.gauges.forEach(function (gauge) {
                    gauge.update({ value: data.percentage });
                });
            } catch (error) {
                console.error('Error parsing data:', error);
            }
        };

        socket.onclose = function (e) {
            // Handle connection close
            console.log('WebSocket error:', e);
            document.getElementById("status").innerHTML = "Disconnected";
            document.getElementById("status").style.background="#ad150d";
        };





        /*
    if (!Array.prototype.forEach) {
        Array.prototype.forEach = function(cb) {
            var i = 0, s = this.length;
            for (; i < s; i++) {
                cb && cb(this[i], i, this);
            }
        }
    }
    
    document.fonts && document.fonts.forEach(function(font) {
        font.loaded.then(function() {
            if (font.family.match(/Led/)) {
                document.gauges.forEach(function(gauge) {
                    gauge.update();
                    gauge.options.renderTo.style.visibility = 'visible';
                });
            }
        });
    });
    
    var timers = [];
    
    function animateGauges() {
        document.gauges.forEach(function(gauge) {
            timers.push(setInterval(function() {
                gauge.value = Math.random() *
                    (gauge.options.maxValue - gauge.options.minValue) +
                    gauge.options.minValue;
            }, gauge.animation.duration + 50));
        });
    }
    
    function stopGaugesAnimation() {
        timers.forEach(function(timer) {
            clearInterval(timer);
        });
    }
    
    function resize() {
        var size = parseFloat(document.getElementById('gauge-size').value) || 400;
    
        document.gauges.forEach(function (gauge) {
            gauge.update({ width: size, height: size });
        });
    }
    
    function setText() {
        var text = document.getElementById('gauge-text').value;
    
        document.gauges.forEach(function (gauge) {
            gauge.update({ valueText: text });
        });
    }*/
    </script>
</body>

</html>
